# ============================================================================
# Telegram Agent Default Configuration
# ============================================================================
# This file contains all hardcoded defaults extracted from the codebase.
# Override these values in .env, environment variables, or config/settings.yaml
# ============================================================================

# ============================================================================
# PATHS
# ============================================================================
paths:
  # Obsidian vault locations
  vault_path: "~/Research/vault"
  vault_temp_images_dir: "~/Research/vault/temp_images"
  vault_temp_docs_dir: "~/Research/vault/temp_docs"
  vault_people_dir: "~/Research/vault/People"

  # Claude Code working directory
  claude_code_work_dir: "~/Research/vault"

  # DataLake virtual environment (for vault scripts)
  datalake_venv: "/Volumes/LaCie/DataLake/.venv"

  # Vault search scripts
  vault_search_script: "~/Research/vault/scripts/vault_search.py"
  vault_embed_script: "~/Research/vault/scripts/embed_note.py"

# ============================================================================
# TIMEOUTS (in seconds unless otherwise noted)
# ============================================================================
timeouts:
  # Message buffering
  buffer_timeout: 2.5                # Seconds to wait after last message before processing
  max_buffer_wait: 30.0              # Maximum seconds to buffer before forced flush

  # Claude Code
  claude_query_timeout: 300          # 5 minutes for Claude queries
  claude_subprocess_timeout: 300     # 5 minutes for subprocess execution
  session_idle_timeout_minutes: 60   # Minutes before session expires

  # Telegram API
  telegram_api_timeout: 30           # API request timeout
  telegram_connect_timeout: 30.0
  telegram_read_timeout: 30.0
  telegram_write_timeout: 30.0
  telegram_pool_timeout: 30.0

  # File downloads
  file_download_timeout: 120         # General file downloads
  image_download_timeout: 120
  voice_download_timeout: 90
  video_download_timeout: 180        # Videos can be large
  document_download_timeout: 120

  # Transcription
  transcription_timeout: 90          # Whisper API timeout
  audio_extraction_timeout: 120      # ffmpeg audio extraction

  # External APIs
  httpx_timeout: 60.0
  link_scrape_timeout: 30
  image_classifier_timeout: 30.0
  health_check_timeout: 5.0
  ip_service_timeout: 5

  # Cleanup
  periodic_cleanup_hours: 1.0
  max_file_age_hours: 1.0

  # Database
  db_health_check_timeout: 5.0

# ============================================================================
# LIMITS
# ============================================================================
limits:
  # Message buffering
  max_buffer_messages: 10            # Max messages before forced flush
  max_buffer_size: 20                # Hard cap on buffer size per user; excess messages dropped

  # LRU caches
  claude_mode_cache_size: 10000      # Cache for claude mode state
  admin_cache_size: 1000             # Cache for admin status
  reply_context_cache_size: 1000     # Cache for reply contexts
  callback_data_max_cache_age: 3600  # Callback data cache TTL (1 hour)

  # Telegram
  telegram_message_max_length: 4096  # Telegram's limit
  telegram_message_safe_length: 4000 # Safe limit with buffer
  telegram_message_chunk_size: 3800  # For splitting long messages
  telegram_callback_data_max_bytes: 64

  # Image processing
  image_max_size_mb: 10              # Max image size to process
  image_resize_max_dimension: 1024   # Max dimension after resize
  image_quality: 85                  # JPEG quality

  # LLM
  llm_max_tokens_default: 500        # Default mode
  llm_max_tokens_detailed: 800       # Artistic/formal mode

  # Content
  max_tracked_captures: 100          # Link capture tracking
  max_tracked_updates: 1000          # Update deduplication
  update_expiry_seconds: 600         # 10 minutes
  link_max_content_length: 10000     # Firecrawl content limit

  # Collect mode
  collect_session_timeout: 3600      # 1 hour
  collect_max_items: 50

  # Per-user rate limiting (Telegram user_id)
  # All Telegram webhook traffic arrives from Telegram's shared IPs,
  # so per-IP limiting alone is insufficient for user-level abuse.
  user_rate_limit_rpm: 30             # Messages/minute for regular users
  user_rate_limit_privileged_rpm: 120 # Messages/minute for OWNER/ADMIN users

  # Similarity search
  similarity_threshold: 0.7
  max_similar_images: 5

  # Gallery
  gallery_per_page: 5
  gallery_sessions_limit: 5          # Max sessions in keyboard

  # Note names
  note_name_max_length: 200

# ============================================================================
# API ENDPOINTS
# ============================================================================
api:
  # Telegram
  telegram_api_base: "https://api.telegram.org"

  # LLM Providers
  groq_api_base: "https://api.groq.com/openai/v1"
  openai_api_base: "https://api.openai.com/v1"

  # Firecrawl
  firecrawl_api_base: "https://api.firecrawl.dev/v1"

  # Voice server (for voice continuation)
  voice_server_url: "https://vox.realitytouch.org"

  # IP detection services (fallback order)
  ip_services:
    - "https://api.ipify.org"
    - "https://ipinfo.io/ip"
    - "https://ifconfig.me/ip"
    - "https://icanhazip.com"
    - "https://ident.me"

  # ngrok
  ngrok_local_api: "http://localhost:4040/api/tunnels"

# ============================================================================
# AI MODELS
# ============================================================================
models:
  # Claude Code - Default model for agent conversations
  # Options: haiku (fastest/cheapest), sonnet (balanced), opus (best quality)
  # Opus 4.6 pricing: $5/MTok input, $25/MTok output (~1.7x Sonnet for significantly better quality)
  claude_default_model: "opus"     # Changed from sonnet to leverage Opus 4.6 improvements

  # Adaptive thinking effort for Claude models (Opus 4.6+)
  # Options: low (fastest), medium (balanced), high (thorough), max (deepest reasoning)
  thinking_effort_default: "medium"

  # Image analysis (LiteLLM)
  llm_default_model: "gpt-4o-mini"

  # Image classification (cheap first, fallback)
  classifier_primary: "meta-llama/llama-4-scout-17b-16e-instruct"  # Groq
  classifier_fallback: "gpt-4o-mini"  # OpenAI fallback

  # Whisper (transcription)
  whisper_model: "whisper-large-v3-turbo"
  whisper_language: "en"

  # STT provider fallback chain (tried in order)
  # Options: groq, local_whisper
  stt_providers: "groq,local_whisper"

# ============================================================================
# CLAUDE CODE TOOL ACCESS
# ============================================================================
# Controls which tools Claude Code can use when executing prompts.
# Configure at install time; not exposed through the bot UI.
#
# allowed_tools: explicit allowlist (if set, ONLY these tools are available)
# disallowed_tools: blocklist (removed from allowed_tools)
#
# Both lists accept Claude Code SDK tool names:
#   Read, Write, Edit, Glob, Grep, Bash, WebFetch, WebSearch,
#   NotebookEdit, Task, Skill, AskUserQuestion
#
# Examples:
#   Read-only mode:  allowed_tools: ["Read", "Glob", "Grep"]
#   No web access:   disallowed_tools: ["WebFetch", "WebSearch"]
#   Full access:     allowed_tools: []  (empty = use default set)
claude_tools:
  # Default toolset. Empty list = SDK defaults (all tools).
  # Set explicitly to restrict what Claude can do.
  allowed_tools:
    - "Read"
    - "Write"
    - "Edit"
    - "Glob"
    - "Grep"
    - "Bash"
    - "WebFetch"
    - "WebSearch"

  # Tools to remove from the allowed set. Applied after allowed_tools.
  # Useful for disabling specific capabilities without rewriting the full list.
  disallowed_tools: []

# ============================================================================
# BOT BEHAVIOR
# ============================================================================
bot:
  # Deep links
  bot_username: "toolbuildingape_bot"  # For deep link generation

  # Commands that bypass message buffering
  bypass_commands:
    - "/help"
    - "/start"
    - "/mode"
    - "/cancel"
    - "/gallery"
    - "/note"

  # Collect mode trigger keywords
  collect_trigger_keywords:
    - "now respond"
    - "process this"
    - "go ahead"
    - "that's all"
    - "done collecting"

  # Auto-collect behavior in Claude locked mode
  # When true: images/videos (without voice) in Claude locked mode auto-start collect mode
  # When false: images/videos go directly to Claude for immediate response
  auto_collect_media_in_claude_mode: false

  # Show confirmation message when auto-collect is triggered
  show_auto_collect_confirmation: true

  # Default mode for new chats
  default_mode: "default"
  default_claude_model: "sonnet"

# ============================================================================
# REACTIONS & EMOJIS
# ============================================================================
reactions:
  # Completion reactions
  completion_reaction_type: "emoji"  # Options: emoji, sticker, animation, none
  completion_reaction_value: "üëç"
  completion_reaction_probability: 1.0

  # Processing state reactions
  processing_start: "üëÄ"             # When starting to process
  processing_complete: "üëç"          # When processing completes
  processing_failed: "ü§î"            # When processing fails

  # Model indicators
  model_emoji:
    haiku: "‚ö°"
    sonnet: "üéµ"
    opus: "üé≠"
    default: "ü§ñ"

# ============================================================================
# MESSAGE TEMPLATES
# ============================================================================
messages:
  # Errors
  error_prefix: "‚ùå"
  error_bot_config: "Bot configuration error"
  error_no_permission: "You don't have permission to use Claude Code."
  error_processing: "Error processing your message. Please try again."
  error_download_failed: "Failed to download images for Claude."
  error_transcription_failed: "Failed to transcribe voice messages."
  error_mode_update: "Error updating mode. Please try again."
  error_image_too_large: "Image is too large ({size}MB). Please send images smaller than {max}MB."

  # Success
  success_prefix: "‚úÖ"

  # Processing
  processing_voice: "Processing voice..."
  processing_image: "üì∑ Sending image to Claude..."
  processing_contact: "üìá Processing contact..."

  # Claude
  claude_status_new_session: "New session"
  claude_status_resuming: "Resuming {session}"
  claude_stopped_by_user: "‚èπÔ∏è **Stopped by user**"

  # Collect mode
  collect_mode_on: "üì• <b>Collect mode ON</b>\n\nSend files, voice, images, text ‚Äî I'll collect them silently.\n\nWhen ready, tap <b>‚ñ∂Ô∏è Go</b> or say <i>\"now respond\"</i>"
  collect_nothing_collected: "üì≠ Nothing collected. Use <code>/collect:start</code> first."

  # File sending captions
  file_caption_image: "üìé {filename}"
  file_caption_audio: "üéµ {filename}"
  file_caption_video: "üé¨ {filename}"
  file_caption_document: "üìÑ {filename}"

  # Transcription
  transcript_prefix: "üìù <b>Transcript:</b>\n\n"
  video_transcript_prefix: "üìù <b>Video Transcript:</b>\n\n"

# ============================================================================
# CORS (for web admin)
# ============================================================================
cors:
  allowed_origins:
    - "http://localhost:3000"
    - "http://localhost:8000"

# ============================================================================
# VAULT INTEGRATION
# ============================================================================
vault:
  # File extensions to send automatically
  sendable_extensions:
    - ".pdf"
    - ".png"
    - ".jpg"
    - ".jpeg"
    - ".gif"
    - ".mp3"
    - ".mp4"
    - ".wav"
    - ".doc"
    - ".docx"
    - ".xlsx"
    - ".csv"
    - ".zip"
    - ".tar"
    - ".gz"

  # Safe directories for file sending (security)
  safe_directories:
    - "{vault_path}"                 # Obsidian vault
    - "{vault_temp_images_dir}"      # Temp images
    - "{home}/ai_projects/telegram_agent/data"
    - "{home}/ai_projects/telegram_agent/outputs"
    - "/tmp"
    - "/private/tmp"

  # Audio extraction settings (ffmpeg)
  audio_codec: "libopus"             # For .ogg output

# ============================================================================
# WEBHOOK
# ============================================================================
webhook:
  max_retries: 5
  retry_delay_seconds: 2

# ============================================================================
# TUNNEL PROVIDERS
# ============================================================================
# Provider: ngrok | cloudflare | tailscale | none
# Auto-detected from ENVIRONMENT if not set (dev=ngrok, prod=cloudflare)
tunnel:
  provider: ""                       # Empty = auto-detect from environment
  port: 8000                         # Port for tunnel to forward to

  # Cloudflare Tunnel
  cloudflare:
    tunnel_name: "telegram-agent"    # Named tunnel (prod) ‚Äî requires credentials
    credentials_file: ""             # Path to cloudflared credentials JSON
    config_file: ""                  # Path to cloudflared config YAML

  # Tailscale Funnel
  tailscale:
    hostname: ""                     # Auto-detected if empty

# ============================================================================
# PLUGINS
# ============================================================================
plugins:
  # Comma-separated list of allowed plugin IDs.
  # Empty string = allow all plugins (backwards compatible).
  # Example: "claude_code,pdf"
  allowlist: ""

  # Safe mode: when true, only load builtin plugins (from src/plugins/builtin/).
  # User plugins (from plugins/) are skipped entirely.
  safe_mode: false

# ============================================================================
# NGROK
# ============================================================================
ngrok:
  default_port: 8000
  default_region: "us"

# ============================================================================
# HEARTBEAT ‚Äî System Health Monitoring
# ============================================================================
heartbeat:
  enabled: true
  interval_minutes: 30
  active_hours_start: 8
  active_hours_end: 23

  # Phase 2: LLM triage (only when issues found)
  triage_enabled: true
  triage_model: "gpt-4o-mini"
  triage_max_tokens: 300

  # Thresholds
  error_rate_warning: 10
  error_rate_critical: 50
  error_window_hours: 6
  stale_message_warning_minutes: 120
  disk_space_warning_percent: 85
  disk_space_critical_percent: 95

  # Memory (RAM) thresholds
  memory_warning_percent: 80
  memory_critical_percent: 90

  # CPU usage thresholds
  cpu_warning_percent: 80
  cpu_critical_percent: 95

  # SQLite database file size thresholds
  db_size_warning_mb: 500
  db_size_critical_mb: 1000

  # Delivery
  show_ok: false

# ============================================================================
# RESOURCE MONITOR ‚Äî Fast-loop Resource Alerting
# ============================================================================
# Opt-in: set RESOURCE_MONITOR_CHAT_IDS (or HEARTBEAT_CHAT_IDS) in your .env
# to enable alerts. If neither variable is set, the monitor does not start.
resource_monitor:
  enabled: true
  interval_minutes: 5      # How often to check resources
  cooldown_minutes: 30     # Min time between repeated alerts for the same resource

# ============================================================================
# LIFE WEEKS ‚Äî Weekly Visualization Notifications
# ============================================================================
life_weeks:
  enabled: true
  max_age_years: 90  # Assume 90-year lifespan for grid
  image_width: 1200
  image_height: 1800
  grid_padding: 40
  cell_size: 20

# ============================================================================
# ACCOUNTABILITY PARTNER (Virtual AI)
# ============================================================================
accountability:
  # Personality presets
  personalities:
    gentle:
      voice: "diana"
      emotion: "whisper"
      struggle_threshold: 5  # Very patient
      celebration_style: "quiet"

    supportive:
      voice: "diana"
      emotion: "cheerful"
      struggle_threshold: 3
      celebration_style: "moderate"

    direct:
      voice: "hannah"
      emotion: "neutral"
      struggle_threshold: 3
      celebration_style: "moderate"

    assertive:
      voice: "troy"
      emotion: "cheerful"
      struggle_threshold: 2  # Quick to intervene
      celebration_style: "enthusiastic"

    tough_love:
      voice: "troy"
      emotion: "neutral"
      struggle_threshold: 2
      celebration_style: "quiet"  # Minimal praise

  # Default settings for new users
  default_personality: "supportive"
  default_check_in_time: "19:00"
  default_struggle_threshold: 3
  default_celebration_style: "moderate"

  # Notification timing
  check_in_window_start: "17:00"
  check_in_window_end: "21:00"
  quiet_hours_start: "22:00"
  quiet_hours_end: "07:00"

  # Milestone thresholds
  milestones:
    - 3   # First few days
    - 7   # One week
    - 14  # Two weeks
    - 30  # One month
    - 60  # Two months
    - 90  # Three months
    - 180 # Six months
    - 365 # One year
